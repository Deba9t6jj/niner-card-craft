<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    
    <meta name="base:app_id" content="69458651d19763ca26ddc571" />
    <meta property="base:app" content="Niner Score" />
    <meta property="base:network" content="base" />
    <meta property="base:theme" content="dark" />
    <meta property="base:version" content="1.0.0" />
    <meta property="base:category" content="social" />
    <meta property="base:supported_chains" content="base,optimism,arbitrum" />
    
    <meta property="fc:frame" content="vNext" />
    <meta property="fc:frame:image" content="https://www.neynar-card-craft.fun/og-image.png" />
    <meta property="fc:frame:image:aspect_ratio" content="1.91:1" />
    <meta property="fc:frame:post_url" content="https://www.neynar-card-craft.fun/api/frame" />
    <meta property="fc:frame:button:1" content="ðŸŽ¯ Get My Score" />
    <meta property="fc:frame:button:1:action" content="post" />
    <meta property="fc:frame:button:2" content="ðŸ† View Tiers" />
    <meta property="fc:frame:button:2:action" content="post" />
    <meta property="fc:frame:button:2:target" content="https://www.neynar-card-craft.fun/api/tiers" />
    <meta property="fc:frame:button:3" content="ðŸ“± Open App" />
    <meta property="fc:frame:button:3:action" content="post_redirect" />
    <meta property="fc:frame:input:text" content="Enter Farcaster username (e.g., deba9t6)" />
    
    <meta property="fc:frame:state" content='{"app":"niner-score","version":"1.0"}' />
    
    <meta name="fc:feature" content="frames" />
    <meta name="fc:feature" content="cast_action" />
    <meta name="fc:feature" content="mini_app" />
    <meta name="fc:feature" content="embedded" />
    
    <meta name="of:version" content="vNext" />
    <meta name="of:accepts:push" content="mint" />
    <meta name="of:accepts:push" content="frame" />
    <meta name="of:accepts:push" content="transaction" />
    <meta name="of:image" content="https://www.neynar-card-craft.fun/og-image.png" />
    <meta name="of:post_url" content="https://www.neynar-card-craft.fun/api/frame" />
    
    <link rel="cast-action" href="https://www.neynar-card-craft.fun/cast-action.json" />
    
    <meta name="neynar:app" content="niner-score" />
    <meta name="neynar:api_version" content="2024-01-01" />
    <meta name="neynar:features" content="frame,cast_action,mini_app,identity" />
    
    <link rel="icon" type="image/png" href="/icon.png" />
    <link rel="apple-touch-icon" href="/icon.png" />
    
    <title>Niner Score | Farcaster Reputation NFT Identity Cards</title>
    <meta name="description" content="Get your free NFT identity card based on your Farcaster engagement score. Bronze, Silver, Gold, or Diamond â€” claim your tier now." />
    <meta name="keywords" content="Farcaster, NFT, identity card, social reputation, Web3, Base, OpenSea" />
    <meta name="author" content="Niner Score" />
    
    <meta name="fc:miniapp" content='{
      "version": "next",
      "imageUrl": "https://www.neynar-card-craft.fun/embed-image.png",
      "button": {
        "title": "Get Your Score",
        "action": {
          "type": "launch_miniapp",
          "name": "Niner Score",
          "url": "https://www.neynar-card-craft.fun",
          "splashImageUrl": "https://www.neynar-card-craft.fun/splash.png",
          "splashBackgroundColor": "#0a0a0f"
        }
      }
    }' />
    
    <meta property="og:title" content="Niner Score â€” Your Farcaster Reputation NFT" />
    <meta property="og:description" content="Connect your Farcaster account and receive a unique NFT identity card based on your social engagement." />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://www.neynar-card-craft.fun" />
    <meta property="og:image" content="https://www.neynar-card-craft.fun/og-image.png" />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta property="og:site_name" content="Niner Score" />
    
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@NinerScore" />
    <meta name="twitter:title" content="Niner Score â€” Your Farcaster Reputation NFT" />
    <meta name="twitter:description" content="Free NFT Identity Cards for Farcaster based on your social reputation score." />
    <meta name="twitter:image" content="https://www.neynar-card-craft.fun/og-image.png" />
    
    <link rel="canonical" href="https://www.neynar-card-craft.fun" />
    
    <meta name="theme-color" content="#0a0a0f" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    
    <style>
        body.base-app-environment {
            background: #0a0a0f;
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }
        
        body.base-app-ready::after {
            content: 'âœ… Base App Connected';
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0, 200, 0, 0.2);
            color: #00ff00;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            z-index: 9999;
        }
        
        body.mini-app {
            background: #0a0a0f;
            margin: 0;
            padding: 16px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        .mini-app-header {
            text-align: center;
            padding: 20px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 24px;
        }
        
        .mini-app-content {
            max-width: 400px;
            margin: 0 auto;
        }
        
        .score-card {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border-radius: 16px;
            padding: 24px;
            margin: 16px 0;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <div id="mini-app-fallback" style="display: none;">
        <div class="mini-app-header">
            <h1 style="color: white; margin: 0;">ðŸŽ¯ Niner Score</h1>
            <p style="color: #9ca3af; margin: 8px 0 0 0;">Farcaster Reputation Mini App</p>
        </div>
        <div class="mini-app-content">
            <div class="score-card">
                <p style="color: #9ca3af; margin: 0 0 12px 0;">Enter your Farcaster username:</p>
                <input type="text" id="username-input" placeholder="deba9t6" style="width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #374151; background: #111827; color: white; margin-bottom: 16px;" />
                <button onclick="getScore()" style="width: 100%; background: #3b82f6; color: white; border: none; padding: 12px; border-radius: 8px; font-size: 16px; cursor: pointer;">
                    Get My Niner Score
                </button>
            </div>
        </div>
    </div>
    
    <script type="module" src="/src/main.tsx"></script>
    
    <script>
        window.BASE_APP_FIX = true;
        
        function sendReadyToBaseApp() {
            if (window.self !== window.parent) {
                const signals = [
                    'ready',
                    'READY',
                    'Ready',
                    'mini_app_ready',
                    'app_ready',
                    JSON.stringify({type: 'ready'}),
                    JSON.stringify({event: 'ready', app: 'niner-score'}),
                    JSON.stringify({status: 'ready', source: 'iframe'}),
                    JSON.stringify({action: 'ready', timestamp: Date.now()}),
                    JSON.stringify({ready: true})
                ];
                
                signals.forEach(signal => {
                    try {
                        window.parent.postMessage(signal, '*');
                    } catch(e) {}
                });
                
                return true;
            }
            return false;
        }
        
        if (window.self !== window.parent) {
            console.log('Base App iframe detected, sending ready signals...');
            
            sendReadyToBaseApp();
            
            [100, 300, 600, 1000, 2000, 3000, 5000, 10000].forEach(delay => {
                setTimeout(sendReadyToBaseApp, delay);
            });
            
            window.addEventListener('load', function() {
                setTimeout(sendReadyToBaseApp, 100);
            });
            
            document.addEventListener('DOMContentLoaded', function() {
                setTimeout(sendReadyToBaseApp, 50);
            });
        }
        
        function initializeMiniApp() {
            const isMiniApp = document.body.classList.contains('mini-app');
            
            if (isMiniApp) {
                setTimeout(() => {
                    if (!document.getElementById('root').children.length) {
                        document.getElementById('mini-app-fallback').style.display = 'block';
                        document.getElementById('root').style.display = 'none';
                    }
                }, 2000);
            }
        }
        
        function getScore() {
            const username = document.getElementById('username-input').value;
            if (!username) return;
            
            fetch(`https://www.neynar-card-craft.fun/api/score?username=${encodeURIComponent(username)}`)
                .then(response => response.json())
                .then(data => {
                    alert(`Your Niner Score: ${data.score}\nTier: ${data.tier}`);
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        }
        
        document.addEventListener('DOMContentLoaded', initializeMiniApp);
        
        window.ReactApp = window.ReactApp || {};
        window.ReactApp.isMiniApp = function() {
            return document.body.classList.contains('mini-app');
        };
        
        window.sendReadyToBaseApp = sendReadyToBaseApp;
    </script>
</body>
</html>
